<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éû„ÉÄ„Éü„Çπ„Çø„Ç§„Éû„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 30px 25px 20px 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .swipe-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            touch-action: pan-y; /* Á∏¶„Çπ„ÇØ„É≠„Éº„É´„ÅØË®±ÂèØ„ÄÅÊ®™„ÅØÂà∂Âæ° */
        }

        .swipe-wrapper {
            display: flex;
            transition: transform 0.3s ease-out;
            width: 200%;
            will-change: transform;
        }

        .swipe-panel {
            width: 50%;
            flex-shrink: 0;
        }

        .swipe-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .indicator-dot.active {
            background: #00d4ff;
            width: 24px;
            border-radius: 4px;
        }

        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .timer-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 30px 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .time {
            font-size: 56px;
            font-weight: 700;
            color: #00d4ff;
            font-variant-numeric: tabular-nums;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
            font-family: 'Arial Black', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', sans-serif;
        }

        .status {
            color: #aaa;
            font-size: 14px;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .time-btn {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 150, 199, 0.2));
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #00d4ff;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .time-btn:hover {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.3), rgba(0, 150, 199, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }

        .time-btn:active {
            transform: translateY(0);
        }

        .custom-timer {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .custom-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #00d4ff;
            padding: 16px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            font-family: 'Arial Black', 'Hiragino Sans', sans-serif;
            width: 100%;
        }

        .custom-input::placeholder {
            color: rgba(0, 212, 255, 0.5);
        }

        .custom-start-btn {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 150, 199, 0.2));
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #00d4ff;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .custom-start-btn:hover {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.3), rgba(0, 150, 199, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }

        .control-btns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .control-btn.stop {
            background: rgba(255, 68, 68, 0.2);
            border-color: rgba(255, 68, 68, 0.3);
            color: #ff6b6b;
        }

        .control-btn.stop:hover {
            background: rgba(255, 68, 68, 0.3);
        }

        .adjust-btns {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .adjust-btn {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            padding: 10px 8px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }

        .adjust-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateY(-1px);
        }

        .adjust-btn:active {
            transform: translateY(0);
        }

        .extra-btns {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .extra-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #888;
            padding: 10px;
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .extra-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #aaa;
        }

        .extra-btn.test {
            background: rgba(100, 255, 100, 0.1);
            border: 1px solid rgba(100, 255, 100, 0.3);
            color: #88ff88;
        }

        .extra-btn.test:hover {
            background: rgba(100, 255, 100, 0.2);
        }

        .bgm-section {
            padding: 0;
        }

        .bgm-title {
            color: #fff;
            font-size: 15px;
            margin-bottom: 12px;
            letter-spacing: 1px;
            text-align: center;
        }

        .bgm-tracks {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .bgm-track-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #aaa;
            padding: 14px 10px;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bgm-track-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .bgm-track-btn.active {
            background: rgba(255, 200, 0, 0.2);
            border-color: rgba(255, 200, 0, 0.5);
            color: #ffc800;
        }

        .bgm-track-btn.playing {
            background: rgba(100, 255, 100, 0.2);
            border-color: rgba(100, 255, 100, 0.5);
            color: #88ff88;
        }

        .bgm-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .bgm-control-btn {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 13px 10px;
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bgm-control-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .bgm-control-btn.active {
            background: rgba(100, 255, 100, 0.2);
            border-color: rgba(100, 255, 100, 0.5);
            color: #88ff88;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px 0; /* „Çø„ÉÉ„ÉÅÈ†òÂüü„ÇíÂ∫É„Åí„Çã */
        }

        .volume-label {
            color: #aaa;
            font-size: 13px;
            min-width: 75px;
        }

        .volume-slider {
            flex: 1;
            height: 8px; /* Â∞ë„ÅóÂ§™„Åè„Åó„Å¶Êìç‰Ωú„Åó„ÇÑ„Åô„Åè */
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
            touch-action: none;
            cursor: pointer;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px; /* Â§ß„Åç„Åè„Åó„Å¶Êìç‰Ωú„Åó„ÇÑ„Åô„Åè */
            height: 20px;
            border-radius: 50%;
            background: #00d4ff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00d4ff;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .swipe-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .indicator-dot:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .indicator-dot.active {
            background: #00d4ff;
            width: 24px;
            border-radius: 4px;
        }

        .credit {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
        }

        .credit span {
            color: #888;
        }

        .credit a {
            color: #00d4ff;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .credit a:hover {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .running .timer-display {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0); }
            50% { box-shadow: 0 0 0 8px rgba(0, 212, 255, 0.1); }
        }

        .finished .time {
            color: #ff6b6b;
            animation: blink 0.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .fullscreen-mode .time {
            font-size: 120px;
            margin-bottom: 20px;
            font-weight: 700;
            font-family: 'Arial Black', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', sans-serif;
        }

        .fullscreen-mode .status {
            font-size: 24px;
            margin-bottom: 40px;
        }

        .exit-fullscreen {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            margin-top: 40px;
        }

        .exit-fullscreen:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 600px) {
            .fullscreen-mode .time {
                font-size: 80px;
            }
            .fullscreen-mode .status {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="container" id="container">
            <h1>TIMER</h1>
            
            <div class="timer-display">
                <div class="time" id="timeDisplay">00:00</div>
                <div class="status" id="status">ÂæÖÊ©ü‰∏≠</div>
            </div>

            <div class="swipe-container" id="swipeContainer">
                <div class="swipe-wrapper" id="swipeWrapper">
                    <!-- Timer Panel -->
                    <div class="swipe-panel">
                        <div class="buttons-grid">
                            <button class="time-btn" onclick="startTimer(1)">1ÂàÜ</button>
                            <button class="time-btn" onclick="startTimer(5)">5ÂàÜ</button>
                            <button class="time-btn" onclick="startTimer(15)">15ÂàÜ</button>
                            <button class="time-btn" onclick="startTimer(20)">20ÂàÜ</button>
                            <button class="time-btn" onclick="startTimer(25)">25ÂàÜ</button>
                            <button class="time-btn" onclick="startTimer(30)">30ÂàÜ</button>
                        </div>

                        <div class="custom-timer">
                            <input type="number" class="custom-input" id="customMinutes" placeholder="ÂàÜ" min="1" max="99">
                            <button class="custom-start-btn" onclick="startCustomTimer()">„Çπ„Çø„Éº„Éà</button>
                        </div>

                        <div class="control-btns">
                            <button class="control-btn" onclick="pauseTimer()">‰∏ÄÊôÇÂÅúÊ≠¢</button>
                            <button class="control-btn stop" onclick="stopTimer()">„É™„Çª„ÉÉ„Éà</button>
                        </div>

                        <div class="adjust-btns">
                            <button class="adjust-btn" onclick="adjustTime(-60)">-1ÂàÜ</button>
                            <button class="adjust-btn" onclick="adjustTime(-10)">-10Áßí</button>
                            <button class="adjust-btn" onclick="adjustTime(10)">+10Áßí</button>
                            <button class="adjust-btn" onclick="adjustTime(60)">+1ÂàÜ</button>
                        </div>

                        <div class="extra-btns">
                            <button class="extra-btn" onclick="toggleFullscreen()">‚õ∂ ÂÖ®ÁîªÈù¢</button>
                            <button class="extra-btn test" onclick="testSound()">üîî Èü≥„ÉÜ„Çπ„Éà</button>
                        </div>
                    </div>

                    <!-- BGM Panel -->
                    <div class="swipe-panel">
                        <div class="bgm-section">
                            <div class="bgm-title">üéµ BGMÈÅ∏Êäû</div>
                            <div class="bgm-tracks">
                                <button class="bgm-track-btn" onclick="toggleBGMTrack('intro')">Â∞éÂÖ•</button>
                                <button class="bgm-track-btn" onclick="toggleBGMTrack('phase1')">Ë™øÊüª1</button>
                                <button class="bgm-track-btn" onclick="toggleBGMTrack('phase2')">Ë™øÊüª2</button>
                                <button class="bgm-track-btn" onclick="toggleBGMTrack('restraint')">ÊãòÊùü</button>
                                <button class="bgm-track-btn" onclick="toggleBGMTrack('ending')" style="grid-column: 1 / -1;">„Ç®„É≥„Éá„Ç£„É≥„Ç∞</button>
                            </div>
                            <div class="bgm-controls">
                                <button class="bgm-control-btn" id="bgmLoopBtn" onclick="toggleLoop()">üîÅ „É´„Éº„Éó OFF</button>
                            </div>
                            <div class="volume-control">
                                <span class="volume-label">Èü≥Èáè <span id="volumeValue">50</span>%</span>
                                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" oninput="updateVolume(this.value)" onchange="updateVolume(this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="swipe-indicator">
                <div class="indicator-dot active" id="dot1"></div>
                <div class="indicator-dot" id="dot2"></div>
            </div>

            <div class="credit">
                <span>Powered by </span>
                <a href="https://x.com/Otamys_omake" target="_blank">Otamys</a>
                <span> from </span>
                <a href="https://www.youtube.com/@omake_no_yoru" target="_blank">„Åä„Åæ„Åë„ÅÆÂ§ú</a>
            </div>
        </div>
    </div>

    <div id="fullscreenDisplay" class="fullscreen-mode" style="display: none;">
        <div class="time" id="fullscreenTime">00:00</div>
        <div class="status" id="fullscreenStatus">ÂæÖÊ©ü‰∏≠</div>
        <button class="exit-fullscreen" onclick="toggleFullscreen()">Êàª„Çã</button>
    </div>

    <audio id="alarmSound" preload="auto">
        <source src="bell.mp3" type="audio/mpeg">
    </audio>

    <audio id="bgmPlayer" preload="auto"></audio>

    <script>
        let countdown;
        let totalSeconds = 0;
        let isPaused = false;
        let remainingSeconds = 0;
        let isFullscreen = false;
        let currentBGM = null;
        let isBGMPlaying = false;
        let isBGMLoop = false;
        let currentPanel = 0;
        let startTime = null;
        let pausedTime = 0;

        const bgmFiles = {
            'intro': 'bgm-intro.mp3',
            'phase1': 'bgm-phase1.mp3',
            'phase2': 'bgm-phase2.mp3',
            'restraint': 'bgm-restraint.mp3',
            'ending': 'bgm-ending.mp3'
        };

        // Swipe functionality
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;
        const swipeContainer = document.getElementById('swipeContainer');
        const swipeWrapper = document.getElementById('swipeWrapper');

        swipeContainer.addEventListener('touchstart', (e) => {
            // „Çπ„É©„Ç§„ÉÄ„Éº„ÅÆ„Çø„ÉÉ„ÉÅ„ÅØÁÑ°Ë¶ñ
            if (e.target.classList.contains('volume-slider')) {
                return;
            }
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: false });

        swipeContainer.addEventListener('touchmove', (e) => {
            // „Çπ„É©„Ç§„ÉÄ„Éº„ÅÆ„Çø„ÉÉ„ÉÅ„ÅØÁÑ°Ë¶ñ
            if (e.target.classList.contains('volume-slider')) {
                return;
            }
            // Ê®™ÊñπÂêë„ÅÆ„Çπ„ÉØ„Ç§„Éó„ÅÆÂ†¥Âêà„ÅÆ„Åø„Éá„Éï„Ç©„É´„ÉàÂãï‰Ωú„ÇíÈò≤„Åê
            const touchCurrentX = e.changedTouches[0].screenX;
            const touchCurrentY = e.changedTouches[0].screenY;
            const diffX = Math.abs(touchCurrentX - touchStartX);
            const diffY = Math.abs(touchCurrentY - touchStartY);
            
            if (diffX > diffY) {
                e.preventDefault();
            }
        }, { passive: false });

        swipeContainer.addEventListener('touchend', (e) => {
            // „Çπ„É©„Ç§„ÉÄ„Éº„ÅÆ„Çø„ÉÉ„ÉÅ„ÅØÁÑ°Ë¶ñ
            if (e.target.classList.contains('volume-slider')) {
                return;
            }
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        });

        // PCÁî®Ôºö„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„Éâ„ÉÉ„Éà„Çí„ÇØ„É™„ÉÉ„ÇØ„ÅßÂàá„ÇäÊõø„Åà
        document.getElementById('dot1').addEventListener('click', () => switchPanel(0));
        document.getElementById('dot2').addEventListener('click', () => switchPanel(1));

        function handleSwipe() {
            const swipeThreshold = 50;
            const diffX = touchStartX - touchEndX;
            const diffY = Math.abs(touchStartY - touchEndY);

            // Ê®™ÊñπÂêë„ÅÆ„Çπ„ÉØ„Ç§„Éó„ÅåÁ∏¶„Çà„ÇäÂ§ß„Åç„ÅÑÂ†¥Âêà„ÅÆ„ÅøÂèçÂøú
            if (Math.abs(diffX) > swipeThreshold && Math.abs(diffX) > diffY) {
                if (diffX > 0 && currentPanel === 0) {
                    // Swipe left - go to BGM panel
                    switchPanel(1);
                } else if (diffX < 0 && currentPanel === 1) {
                    // Swipe right - go to Timer panel
                    switchPanel(0);
                }
            }
        }

        function switchPanel(panelIndex) {
            currentPanel = panelIndex;
            swipeWrapper.style.transform = `translateX(-${panelIndex * 50}%)`;
            
            document.getElementById('dot1').classList.toggle('active', panelIndex === 0);
            document.getElementById('dot2').classList.toggle('active', panelIndex === 1);
        }

        function startTimer(minutes) {
            stopTimer();
            totalSeconds = minutes * 60;
            remainingSeconds = totalSeconds;
            isPaused = false;
            startTime = Date.now();
            pausedTime = 0;
            
            document.getElementById('container').classList.remove('finished');
            document.getElementById('container').classList.add('running');
            document.getElementById('status').textContent = '„Ç´„Ç¶„É≥„Éà‰∏≠';
            
            updateDisplay();
            runTimer();
        }

        function startCustomTimer() {
            const minutes = parseInt(document.getElementById('customMinutes').value);
            if (minutes && minutes > 0 && minutes <= 99) {
                startTimer(minutes);
                document.getElementById('customMinutes').value = '';
            } else {
                alert('1„Äú99„ÅÆÊï∞Â≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        }

        function runTimer() {
            countdown = setInterval(() => {
                if (!isPaused) {
                    // „Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Éô„Éº„Çπ„ÅßÊ≠£Á¢∫„Å™ÁµåÈÅéÊôÇÈñì„ÇíË®àÁÆó
                    const elapsed = Math.floor((Date.now() - startTime - pausedTime) / 1000);
                    remainingSeconds = totalSeconds - elapsed;
                    
                    if (remainingSeconds <= 0) {
                        remainingSeconds = 0;
                        updateDisplay();
                        timerFinished();
                        return;
                    }
                    
                    updateDisplay();
                }
            }, 100); // „Çà„ÇäÈ†ªÁπÅ„Å´Êõ¥Êñ∞„Åó„Å¶„Ç∫„É¨„ÇíÈò≤„Åê
        }

        function updateDisplay() {
            const minutes = Math.floor(remainingSeconds / 60);
            const seconds = remainingSeconds % 60;
            const timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            document.getElementById('timeDisplay').textContent = timeString;
            document.getElementById('fullscreenTime').textContent = timeString;
        }

        function pauseTimer() {
            if (countdown && !isPaused) {
                isPaused = true;
                pausedTime += Date.now() - startTime - pausedTime;
                const statusText = '‰∏ÄÊôÇÂÅúÊ≠¢‰∏≠';
                document.getElementById('status').textContent = statusText;
                document.getElementById('fullscreenStatus').textContent = statusText;
                document.getElementById('container').classList.remove('running');
                document.getElementById('fullscreenDisplay').classList.remove('running');
            } else if (countdown && isPaused) {
                isPaused = false;
                startTime = Date.now();
                const statusText = '„Ç´„Ç¶„É≥„Éà‰∏≠';
                document.getElementById('status').textContent = statusText;
                document.getElementById('fullscreenStatus').textContent = statusText;
                document.getElementById('container').classList.add('running');
                document.getElementById('fullscreenDisplay').classList.add('running');
            }
        }

        function adjustTime(seconds) {
            if (!countdown) {
                return; // „Çø„Ç§„Éû„Éº„ÅåÂãï„ÅÑ„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            }
            
            remainingSeconds += seconds;
            
            // 0ÁßíÊú™Ê∫Ä„Å´„ÅØ„Åó„Å™„ÅÑ
            if (remainingSeconds < 0) {
                remainingSeconds = 0;
            }
            
            // „Çø„Ç§„É†„Çπ„Çø„É≥„Éó„ÇíË™øÊï¥
            if (!isPaused) {
                const elapsed = totalSeconds - remainingSeconds;
                startTime = Date.now() - (elapsed * 1000) - pausedTime;
            } else {
                pausedTime = (totalSeconds - remainingSeconds) * 1000;
            }
            
            updateDisplay();
            
            // 0Áßí„Å´„Å™„Å£„Åü„ÇâÁµÇ‰∫Ü
            if (remainingSeconds <= 0) {
                timerFinished();
            }
        }

        function stopTimer() {
            clearInterval(countdown);
            countdown = null;
            isPaused = false;
            remainingSeconds = 0;
            totalSeconds = 0;
            startTime = null;
            pausedTime = 0;
            const timeString = '00:00';
            const statusText = 'ÂæÖÊ©ü‰∏≠';
            
            document.getElementById('timeDisplay').textContent = timeString;
            document.getElementById('fullscreenTime').textContent = timeString;
            document.getElementById('status').textContent = statusText;
            document.getElementById('fullscreenStatus').textContent = statusText;
            document.getElementById('container').classList.remove('running', 'finished');
            document.getElementById('fullscreenDisplay').classList.remove('running', 'finished');
        }

        function timerFinished() {
            clearInterval(countdown);
            const statusText = 'ÁµÇ‰∫ÜÔºÅ';
            
            document.getElementById('container').classList.remove('running');
            document.getElementById('container').classList.add('finished');
            document.getElementById('fullscreenDisplay').classList.remove('running');
            document.getElementById('fullscreenDisplay').classList.add('finished');
            document.getElementById('status').textContent = statusText;
            document.getElementById('fullscreenStatus').textContent = statusText;
            
            playAlarm();
            
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200, 100, 200, 100, 200]);
            }
        }

        function playAlarm() {
            const audio = document.getElementById('alarmSound');
            audio.volume = 1.0;
            
            let count = 0;
            function playBell() {
                if (count < 3) {
                    audio.currentTime = 0;
                    audio.play().catch(e => console.log('Play failed:', e));
                    count++;
                    setTimeout(playBell, 2000);
                }
            }
            playBell();
        }

        function testSound() {
            const audio = document.getElementById('alarmSound');
            audio.volume = 1.0;
            audio.currentTime = 0;
            audio.play()
                .then(() => {
                    alert('Èü≥„ÅåÈ≥¥„Çä„Åæ„Åó„ÅüÔºÅ‚úì');
                })
                .catch(e => {
                    alert('Èü≥„ÅåÈ≥¥„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇÈü≥Èáè„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                });
        }

        // BGM Functions
        function toggleBGMTrack(track) {
            const bgmPlayer = document.getElementById('bgmPlayer');
            const buttons = document.querySelectorAll('.bgm-track-btn');
            const clickedButton = event.target;
            
            // Âêå„ÅòÊõ≤„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÂÅúÊ≠¢
            if (currentBGM === track && isBGMPlaying) {
                bgmPlayer.pause();
                isBGMPlaying = false;
                clickedButton.classList.remove('playing');
                return;
            }
            
            // ÂÖ®„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„Çí„É™„Çª„ÉÉ„Éà
            buttons.forEach(btn => {
                btn.classList.remove('active', 'playing');
            });
            
            // Êñ∞„Åó„ÅÑÊõ≤„ÇíÈÅ∏Êäû
            currentBGM = track;
            bgmPlayer.src = bgmFiles[track];
            bgmPlayer.volume = document.getElementById('volumeSlider').value / 100;
            bgmPlayer.load();
            
            clickedButton.classList.add('active', 'playing');
            
            // ÂÜçÁîü
            bgmPlayer.play().then(() => {
                isBGMPlaying = true;
            }).catch(e => {
                console.log('Play failed:', e);
                isBGMPlaying = false;
                clickedButton.classList.remove('playing');
            });
        }

        // BGMÁµÇ‰∫ÜÊôÇ„ÅÆÂá¶ÁêÜ
        document.getElementById('bgmPlayer').addEventListener('ended', () => {
            if (!isBGMLoop) {
                isBGMPlaying = false;
                document.querySelectorAll('.bgm-track-btn').forEach(btn => {
                    btn.classList.remove('playing');
                });
            }
        });

        function toggleLoop() {
            const bgmPlayer = document.getElementById('bgmPlayer');
            const loopBtn = document.getElementById('bgmLoopBtn');
            
            isBGMLoop = !isBGMLoop;
            bgmPlayer.loop = isBGMLoop;
            
            if (isBGMLoop) {
                loopBtn.textContent = 'üîÅ „É´„Éº„Éó ON';
                loopBtn.classList.add('active');
            } else {
                loopBtn.textContent = 'üîÅ „É´„Éº„Éó OFF';
                loopBtn.classList.remove('active');
            }
        }

        function updateVolume(value) {
            const bgmPlayer = document.getElementById('bgmPlayer');
            const volumePercent = parseInt(value);
            bgmPlayer.volume = volumePercent / 100;
            document.getElementById('volumeValue').textContent = volumePercent;
        }

        // Initialize audio on first interaction
        let audioReady = false;
        document.addEventListener('click', function initAudio() {
            if (!audioReady) {
                const audio = document.getElementById('alarmSound');
                audio.load();
                audioReady = true;
            }
        }, { once: true });

        function toggleFullscreen() {
            isFullscreen = !isFullscreen;
            const fullscreenDisplay = document.getElementById('fullscreenDisplay');
            
            if (isFullscreen) {
                fullscreenDisplay.style.display = 'flex';
                
                document.getElementById('fullscreenStatus').textContent = 
                    document.getElementById('status').textContent;
                
                if (document.getElementById('container').classList.contains('running')) {
                    fullscreenDisplay.classList.add('running');
                }
                if (document.getElementById('container').classList.contains('finished')) {
                    fullscreenDisplay.classList.add('finished');
                }
            } else {
                fullscreenDisplay.style.display = 'none';
            }
        }
    </script>
</body>
</html>
